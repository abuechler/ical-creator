<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>iCal Creator</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ical.js/1.5.0/ical.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>iCal Creator</h1>
      <p class="subtitle">
        Create and download calendar events
        <button type="button" class="info-icon-btn" id="privacyInfoBtn" aria-label="Privacy information">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 0a8 8 0 100 16A8 8 0 008 0zm0 14.5a6.5 6.5 0 110-13 6.5 6.5 0 010 13zM8 6a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 018 6zm0-2.5a1 1 0 100 2 1 1 0 000-2z"/>
          </svg>
        </button>
      </p>
    </header>

    <!-- Privacy Modal -->
    <div class="modal-overlay" id="privacyModal" aria-hidden="true">
      <div class="modal" role="dialog" aria-labelledby="privacyModalTitle">
        <div class="modal-header">
          <h2 class="modal-title" id="privacyModalTitle">Privacy Information</h2>
          <button type="button" class="modal-close" id="privacyModalClose" aria-label="Close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="privacy-modal-title">
            <img src="lock.svg" alt="" class="privacy-modal-icon">
            <strong>Your data stays private</strong>
          </div>
          <p>All data is stored locally on your device using your browser's localStorage. Nothing is sent to or stored on any external server.</p>
          <p>This means:</p>
          <ul>
            <li>Your events are only accessible on this device and browser</li>
            <li>Clearing your browser data will remove saved events</li>
            <li>No account or sign-up required</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- ICS Preview Modal -->
    <div class="modal-overlay" id="icsPreviewModal" aria-hidden="true">
      <div class="modal modal-large" role="dialog" aria-labelledby="icsPreviewModalTitle">
        <div class="modal-header">
          <h2 class="modal-title" id="icsPreviewModalTitle">ICS File Preview</h2>
          <button type="button" class="modal-close" id="icsPreviewModalClose" aria-label="Close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="ics-preview-actions">
            <button type="button" class="btn btn-secondary btn-small" id="copyIcsBtn">Copy to Clipboard</button>
            <span class="copy-feedback" id="copyFeedback">Copied!</span>
          </div>
          <pre class="ics-preview-content" id="icsPreviewContent"></pre>
        </div>
      </div>
    </div>

    <div class="form-area">
      <div class="form-inputs">
        <form id="eventForm" novalidate>
        <!-- Basic Event Info -->
        <section class="card" aria-labelledby="basic-info-title">
        <h2 class="card-title" id="basic-info-title">Event Details</h2>

        <div class="form-group">
          <label for="title">Event Title <span class="label-required">*</span></label>
          <input type="text" id="title" name="title" required placeholder="e.g., Team Meeting">
          <div class="field-error" id="title-error">Please enter an event title</div>
        </div>

        <div class="form-group">
          <div class="checkbox-group">
            <input type="checkbox" id="allDay" name="allDay">
            <label for="allDay">All-day event</label>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="startDate">Start Date <span class="label-required">*</span></label>
            <input type="date" id="startDate" name="startDate" required>
            <div class="field-error" id="startDate-error">Please select a start date</div>
          </div>
          <div class="form-group" id="startTimeGroup">
            <label for="startTime">Start Time <span class="label-required">*</span></label>
            <input type="time" id="startTime" name="startTime" required>
            <div class="field-error" id="startTime-error">Please select a start time</div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="endDate">End Date <span class="label-optional">(optional)</span></label>
            <input type="date" id="endDate" name="endDate">
          </div>
          <div class="form-group" id="endTimeGroup">
            <label for="endTime">End Time <span class="label-optional">(optional)</span></label>
            <input type="time" id="endTime" name="endTime">
          </div>
        </div>

        <div class="form-group">
          <label for="timezone">Timezone</label>
          <select id="timezone" name="timezone">
            <!-- Populated by JavaScript -->
          </select>
        </div>

        <div class="form-group">
          <label for="location">Location <span class="label-optional">(optional)</span></label>
          <input type="text" id="location" name="location" placeholder="e.g., Conference Room A">
        </div>

        <div class="form-group">
          <label for="description">Description <span class="label-optional">(optional)</span></label>
          <textarea id="description" name="description" placeholder="Add event details..."></textarea>
        </div>

        <div class="form-group">
          <label for="url">URL <span class="label-optional">(optional)</span></label>
          <input type="url" id="url" name="url" placeholder="e.g., https://meet.example.com/abc">
        </div>
      </section>

      <!-- Recurrence Options -->
      <section class="card" aria-labelledby="recurrence-title">
        <h2 class="card-title" id="recurrence-title">Recurrence</h2>

        <div class="toggle-section">
          <span class="toggle-label">Repeat this event</span>
          <label class="toggle-switch">
            <input type="checkbox" id="isRecurring" name="isRecurring">
            <span class="toggle-slider" role="presentation"></span>
            <span class="sr-only">Enable recurring event</span>
          </label>
        </div>

        <div class="collapsible-content" id="recurrenceOptions">
          <div class="form-row">
            <div class="form-group">
              <label for="frequency">Repeat</label>
              <select id="frequency" name="frequency">
                <option value="DAILY">Daily</option>
                <option value="WEEKLY">Weekly</option>
                <option value="MONTHLY">Monthly</option>
              </select>
            </div>
            <div class="form-group">
              <label for="interval">Every</label>
              <select id="interval" name="interval">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
              </select>
            </div>
          </div>

          <!-- Weekly Day Selection -->
          <div class="form-group" id="weeklyDaysGroup">
            <label>Repeat on</label>
            <div class="day-picker" role="group" aria-label="Select days of the week">
              <button type="button" class="day-picker-btn" data-day="MO" aria-pressed="false">Mon</button>
              <button type="button" class="day-picker-btn" data-day="TU" aria-pressed="false">Tue</button>
              <button type="button" class="day-picker-btn" data-day="WE" aria-pressed="false">Wed</button>
              <button type="button" class="day-picker-btn" data-day="TH" aria-pressed="false">Thu</button>
              <button type="button" class="day-picker-btn" data-day="FR" aria-pressed="false">Fri</button>
              <button type="button" class="day-picker-btn" data-day="SA" aria-pressed="false">Sat</button>
              <button type="button" class="day-picker-btn" data-day="SU" aria-pressed="false">Sun</button>
            </div>
            <div class="field-error" id="weeklyDays-error">Please select at least one day</div>
          </div>

          <!-- Monthly Type Selection -->
          <div class="form-group" id="monthlyTypeGroup">
            <label>Repeat by</label>
            <div class="radio-stack">
              <div class="radio-option">
                <input type="radio" id="monthlyByDate" name="monthlyType" value="date" checked>
                <div class="radio-option-content">
                  <label for="monthlyByDate" class="radio-option-label">Day of month</label>
                  <div class="radio-option-hint" id="monthlyDateHint">e.g., the 15th of every month</div>
                </div>
              </div>
              <div class="radio-option">
                <input type="radio" id="monthlyByDay" name="monthlyType" value="day">
                <div class="radio-option-content">
                  <label for="monthlyByDay" class="radio-option-label">Day of week</label>
                  <div class="radio-option-hint" id="monthlyDayHint">e.g., the 2nd Tuesday of every month</div>
                </div>
              </div>
            </div>
          </div>

          <!-- End Condition -->
          <div class="form-group">
            <label>Ends</label>
            <div class="radio-stack">
              <div class="radio-option">
                <input type="radio" id="endByDate" name="endType" value="date" checked>
                <div class="radio-option-content">
                  <label for="endByDate" class="radio-option-label">On date</label>
                  <input type="date" id="recurrenceEndDate" name="recurrenceEndDate" style="margin-top: 6px;">
                </div>
              </div>
              <div class="radio-option">
                <input type="radio" id="endByCount" name="endType" value="count">
                <div class="radio-option-content">
                  <label for="endByCount" class="radio-option-label">After occurrences</label>
                  <input type="number" id="occurrenceCount" name="occurrenceCount" min="1" max="999" value="10" style="margin-top: 6px; width: 100px;" disabled>
                </div>
              </div>
              <div class="radio-option">
                <input type="radio" id="endNever" name="endType" value="never">
                <div class="radio-option-content">
                  <label for="endNever" class="radio-option-label">Never</label>
                </div>
              </div>
            </div>
            <div class="warning-box" id="neverEndWarning">
              Most events should have an end date. Consider setting an end date to avoid cluttering your calendar.
            </div>
          </div>
        </div>
      </section>

      <!-- Reminder -->
      <section class="card" aria-labelledby="reminder-title">
        <h2 class="card-title" id="reminder-title">Reminder</h2>

        <div class="toggle-section">
          <span class="toggle-label">Add a reminder</span>
          <label class="toggle-switch">
            <input type="checkbox" id="hasReminder" name="hasReminder">
            <span class="toggle-slider" role="presentation"></span>
            <span class="sr-only">Enable reminder</span>
          </label>
        </div>

        <div class="collapsible-content" id="reminderOptions">
          <div class="form-group">
            <label for="reminderTime">Remind me</label>
            <select id="reminderTime" name="reminderTime">
              <option value="5">5 minutes before</option>
              <option value="15" selected>15 minutes before</option>
              <option value="30">30 minutes before</option>
              <option value="60">1 hour before</option>
              <option value="1440">1 day before</option>
            </select>
          </div>
        </div>
      </section>

      <!-- Validation Status -->
      <div class="validation-status" id="validationStatus" role="alert">
        <div class="validation-status-title" id="validationTitle"></div>
        <div id="validationMessage"></div>
      </div>

      <!-- Action Buttons -->
      <div class="btn-group">
        <button type="button" class="btn btn-secondary" id="newEventBtn">New Event</button>
        <button type="button" class="btn btn-secondary" id="previewIcsBtn">Preview ICS</button>
        <button type="submit" class="btn btn-primary" id="downloadBtn">Download .ics</button>
      </div>
      <p class="download-hint hidden" id="downloadHint">Fix errors above to download</p>
        </form>
      </div>

      <!-- Preview (shown when recurring) -->
      <div class="form-preview">
        <section class="card" id="previewSection" aria-labelledby="preview-title" style="display: none;">
          <h2 class="card-title" id="preview-title">Preview & Exceptions</h2>
          <p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 16px;">
            Click on highlighted dates to exclude them from the recurring event.
          </p>

          <div class="calendar-container">
            <div class="calendar-header">
              <button type="button" class="calendar-nav-btn" id="prevMonth" aria-label="Previous month">&larr;</button>
              <span class="calendar-month-year" id="calendarMonthYear" aria-live="polite"></span>
              <button type="button" class="calendar-nav-btn" id="nextMonth" aria-label="Next month">&rarr;</button>
            </div>
            <div class="calendar-grid" id="calendarGrid" role="grid" aria-label="Event preview calendar">
              <!-- Populated by JavaScript -->
            </div>
            <div class="calendar-info">
              <div class="calendar-legend">
                <div class="legend-item">
                  <span class="legend-dot event"></span>
                  <span>Event</span>
                </div>
                <div class="legend-item">
                  <span class="legend-dot exception"></span>
                  <span>Excluded</span>
                </div>
              </div>
              <div id="exceptionCount" class="exception-toggle" role="button" tabindex="0" aria-expanded="false">
                <span id="exceptionCountText">0 exceptions</span>
                <span class="exception-toggle-icon">â–¶</span>
              </div>
            </div>
            <div id="exceptionList" class="exception-list" aria-hidden="true">
              <!-- Populated by JavaScript -->
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- Saved Events Section -->
    <section class="card" id="savedEventsSection" style="display: none;">
      <div class="saved-events-header">
        <h2 class="card-title" id="saved-events-title">Saved Events</h2>
        <button type="button" class="btn btn-secondary btn-sm" id="clearAllBtn">Clear All</button>
      </div>
      <div id="savedEventsList" class="saved-events-list">
        <!-- Populated by JavaScript -->
      </div>
    </section>

    <!-- Debug Info -->
    <details class="debug-info" id="debugInfo">
      <summary class="debug-info-title">Debug Info</summary>
      <div class="debug-info-content">
      <div class="debug-info-row">
        <span class="debug-info-label">Detected timezone:</span>
        <span class="debug-info-value" id="debugDetectedTz">-</span>
      </div>
      <div class="debug-info-row">
        <span class="debug-info-label">Preferred timezone:</span>
        <span class="debug-info-value" id="debugPreferredTz">-</span>
      </div>
      <div class="debug-info-row">
        <span class="debug-info-label">Selected timezone:</span>
        <span class="debug-info-value" id="debugSelectedTz">-</span>
      </div>
      <div class="debug-info-row">
        <span class="debug-info-label">localStorage exists:</span>
        <span class="debug-info-value" id="debugLocalStorage">-</span>
      </div>
      <div style="margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap;">
        <button type="button" class="btn btn-secondary btn-sm" id="resetTimezoneBtn">Reset Timezone to Detected</button>
        <button type="button" class="btn btn-secondary btn-sm" id="clearLocalStorageBtn">Clear All Local Storage</button>
      </div>
      </div>
    </details>
  </div>

  <footer class="site-footer">
    <a href="https://github.com/abuechler/ical-creator" class="github-link" target="_blank" rel="noopener noreferrer">
      <svg viewBox="0 0 16 16" aria-hidden="true">
        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
      </svg>
      View on GitHub
    </a>
    <span class="version"><!-- VERSION_PLACEHOLDER --></span>
  </footer>

  <script src="script.js"></script>
</body>
</html>
